package me.GameOfLife.se;

import java.util.Collection;
import java.util.Collections;
import java.util.HashSet;
import java.util.Iterator;
import java.util.MissingResourceException;
import java.util.Set;
import javax.swing.Timer;
import java.awt.event.*;
import java.awt.*;
public class GameOflifegraph  implements ActionListener{

	

	    /** A reference to use when setting the speed. */
	    private final int  SPEED_REFERENCE = 1000;
	    /** The speed of this simulation. */
	    private int        speed           = 3;
	    /** The timer that triggers ticks to be sent out to the entities. */
	    private Timer      timer           = new Timer(SPEED_REFERENCE/speed,this);
	    /** The width of this pasture */
	    private int         width          = 25;
	    /** The height of this pasture */
	    private int         height         = 20;
	   
	    private char[][] world = World[height][width];
	    
	    private GameOfLifeGUI gui;

	    public GameOflifegraph(GameOfLifeGUI gui) {
	    	this.gui = gui;
	    	initWorld();
	    	setSeed();
	    }

	  
		private int checkSurroundings(int xPos, int yPos) {
			
			int countNeighbours = 0;
			for ( int x = xPos -1; x <= xPos +1; x++){
				for ( int y = yPos -1; y <= yPos +1; y++){
					if (!(x == xPos && y == yPos)){
						try {
							if ( world[x][y] == 'X'){
								countNeighbours++; 
							}
						}
						catch (Exception ex){
							
							
						}
					}
				}
			}
			return countNeighbours;
			
			}
			
			
			private void updateWorld() {
			
			char[][] newWorld = new char[width][height];
			
			int border =0;
			
			for(int i = 0+border; i < width-border; i++) {
			for (int j = 0+border; j< height-border; j++) {
				newWorld[i][j] = '.';
				
				int neighbours = checkSurroundings(i,j);
				
				if ( world[i][j] == 'X'){
					
				
				if(neighbours < 2) {
					newWorld[i][j] = '.';
				}
				if (neighbours >= 2 && neighbours <= 3) {
					newWorld [i][j] = 'X';
				}
				if(neighbours > 3) {
					newWorld[i][j] = '.';
				}
				}
				if ( neighbours == 3 && world[i][j]== '.'){
					newWorld[i][j]= 'X';
				}
					}
				}
			for(int i = 0; i < width; i++) {
				for (int j = 0; j< height; j++) {
					world[i][j] = newWorld[i][j];
				}
			}
			}
	    public void actionPerformed(ActionEvent e) {
	    	
	    	updateWorld();
		    gui.updateAll();
		}
	    
		public void initWorld(){
			for(int i = 0; i < width; i++) {
				for (int j = 0; j< height; j++) {
				world[i][j] = '.';
					}
				}
		}
		
		public void setSeed() {
			for (int i = 0 ; i < width; i++){
				for (int j =0; j < height; j++){
					if (Math.random() < 0.2){
					world[i][j] = 'X';
				}
			}
			}
		}
	       
	    public void start() {
		
		timer.start();
	    }
	    
	    public void stop() {
		timer.stop();
	    }

	    public int getWidth() {
		return width;
	    }

	    public int getHeight() {
		return height;
	    }
	}
